<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Johzzy Pages</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="some code, some note.">
<meta property="og:type" content="website">
<meta property="og:title" content="Johzzy Pages">
<meta property="og:url" content="https://johzzy.github.io/index.html">
<meta property="og:site_name" content="Johzzy Pages">
<meta property="og:description" content="some code, some note.">
<meta property="og:locale">
<meta property="article:author" content="johzzy">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/public/css/style.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/public/" id="logo">Johzzy Pages</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/public/">Home</a>
        
          <a class="main-nav-link" href="/public/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://johzzy.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-simulcast-support-in-srs" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/public/2021/06/18/simulcast-support-in-srs/" class="article-date">
  <time datetime="2021-06-18T10:50:41.000Z" itemprop="datePublished">2021-06-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/public/2021/06/18/simulcast-support-in-srs/">simulcast support in srs</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近弄明白了 Simulcast, 就给 SRS 加了 Simulcast 功能支持, 不过是 Chrome 独有的 SDP munging 风格的 Simulcast, 以后了解清楚了标准的 Simulcast 格式再完善一下.</p>
<p>PR 详见 <a target="_blank" rel="noopener" href="https://github.com/ossrs/srs/pull/2420">https://github.com/ossrs/srs/pull/2420</a></p>
<h2 id="发布端"><a href="#发布端" class="headerlink" title="发布端"></a>发布端</h2><p>使用  <code>numberOfSimulcastLayers</code> 标示 Simulcast 层级数, 可选的有效值为 1,2,3; 其中1为默认值, 此外的其他值为无效值, 若误用会重置为默认1.</p>
<p><code>numberOfSimulcastLayers = 1</code> 相当于 <code>Simulcast 流</code> 退化为 <code>单流</code></p>
<pre><code>webrtc://127.0.0.1/live/livestream?numberOfSimulcastLayers=1  (相当于单流)
webrtc://127.0.0.1/live/livestream?numberOfSimulcastLayers=2  (2 层 Simulcast 流)
webrtc://127.0.0.1/live/livestream?numberOfSimulcastLayers=3  (3 层 Simulcast 流)
</code></pre><h2 id="播放端"><a href="#播放端" class="headerlink" title="播放端"></a>播放端</h2><p>播放端使用 <code>layer</code> 选择哪一层视频流,可选的有效值为 0,1,2,3,…<br>如果 <code>layer</code> 对应的视频流无法播放,则退化为一般场景的播放端.</p>
<pre><code>low: webrtc://127.0.0.1/live/livestream?layer=0
mid: webrtc://127.0.0.1/live/livestream?layer=1
high: webrtc://127.0.0.1/live/livestream?layer=2
other1: webrtc://127.0.0.1/live/livestream?layer=1,2
other2: webrtc://127.0.0.1/live/livestream?layer=1,2&amp;foo=bar
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://johzzy.github.io/2021/06/18/simulcast-support-in-srs/" data-id="ckq28t730001c97vqepx96boo" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/public/tags/webrtc/" rel="tag">webrtc</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-simulcast" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/public/2021/06/16/simulcast/" class="article-date">
  <time datetime="2021-06-16T09:26:05.000Z" itemprop="datePublished">2021-06-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/public/2021/06/16/simulcast/">Simulcast</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Simulcast, 效果演示可以参考这个项目 <a target="_blank" rel="noopener" href="https://fippo.github.io/simulcast-playground/">simulcast-playground</a></p>
<h3 id="H264EncoderImpl-实现"><a href="#H264EncoderImpl-实现" class="headerlink" title="H264EncoderImpl 实现"></a>H264EncoderImpl 实现</h3><p>就 H264 而言, H264EncoderImpl 实现了Simulcast 功能, 为了使用 H264EncoderImpl, 需要webrtc编译ffmpeg和openh264, 代码可以参考 <a target="_blank" rel="noopener" href="https://github.com/johzzy/webrtc-mirror/tree/feature/h264">https://github.com/johzzy/webrtc-mirror/tree/feature/h264</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">// modules/video_coding/codecs/h264/h264_encoder_impl.cc</span><br><span class="line">int32_t H264EncoderImpl::InitEncode(const VideoCodec* inst,</span><br><span class="line">                                    const VideoEncoder::Settings&amp; settings) &#123;</span><br><span class="line">    ...</span><br><span class="line">    for (int i = 0, idx = number_of_streams - 1; i &lt; number_of_streams;</span><br><span class="line">       ++i, --idx) &#123;</span><br><span class="line">    ISVCEncoder* openh264_encoder;</span><br><span class="line">    // Create encoder.</span><br><span class="line">    if (WelsCreateSVCEncoder(&amp;openh264_encoder) != 0) &#123;</span><br><span class="line">      // Failed to create encoder.</span><br><span class="line">      RTC_LOG(LS_ERROR) &lt;&lt; &quot;Failed to create OpenH264 encoder&quot;;</span><br><span class="line">      RTC_DCHECK(!openh264_encoder);</span><br><span class="line">      Release();</span><br><span class="line">      ReportError();</span><br><span class="line">      return WEBRTC_VIDEO_CODEC_ERROR;</span><br><span class="line">    &#125;</span><br><span class="line">    RTC_DCHECK(openh264_encoder);</span><br><span class="line">    if (kOpenH264EncoderDetailedLogging) &#123;</span><br><span class="line">      int trace_level = WELS_LOG_DETAIL;</span><br><span class="line">      openh264_encoder-&gt;SetOption(ENCODER_OPTION_TRACE_LEVEL, &amp;trace_level);</span><br><span class="line">    &#125;</span><br><span class="line">    // else WELS_LOG_DEFAULT is used by default.</span><br><span class="line"></span><br><span class="line">    // Store h264 encoder.</span><br><span class="line">    encoders_[i] = openh264_encoder;</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>
<p>从 <code>H264EncoderImpl::InitEncode</code> 函数可以看到, 真正负责编码工作的对象是 <code>ISVCEncoder* openh264_encoder;</code>, <code>Simulcast</code> 和 <code>SVC</code> 都可以由它完成.</p>
<p>在 <code>Android/iOS</code> 等移动端, <code>H264EncoderImpl</code> 实现的 <code>Simulcast</code> 因 <code>OpenH264</code> 软件编码的缘故, 往往有CPU算力和电池续航方面的不足. </p>
<p>另外, <code>WebRTC iOS</code>编译 <code>FFmpeg</code> 和 <code>OpenH264</code> 依然是一个巨坑. 那么有没有利用硬件编码实现的Simulcast呢.</p>
<h3 id="SimulcastEncoderAdapter-实现"><a href="#SimulcastEncoderAdapter-实现" class="headerlink" title="SimulcastEncoderAdapter 实现"></a>SimulcastEncoderAdapter 实现</h3><p><code>SimulcastEncoderAdapter</code> 代码详见 <code>media/engine/simulcast_encoder_adapter.cc</code>, 它本身是一个通用的适配器, 给SimulcastEncoderAdapter 传入相应的编码器工厂，就可以组成一个simulcast的编码器, </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SimulcastEncoderAdapter::SimulcastEncoderAdapter(VideoEncoderFactory* factory,</span><br><span class="line">                                                 const SdpVideoFormat&amp; format)</span><br><span class="line">    : SimulcastEncoderAdapter(factory, nullptr, format) &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>具体来说, 在 <code>Android</code> 平台,可以给 <code>SimulcastEncoderAdapter</code> 传入 <code>mediacodec</code> 的 <code>h264</code> 编码器开启硬编,在 <code>iOS</code> 平台则可以传入 <code>videotoolbox</code>. 当然,你可以 SimulcastEncoderAdapter 做到不同层级的视频使用不同的编码器, 混合使用.</p>
<p>在 chrome 中 h264 的 simulcast 就是这样实现的，在 <code>chrome://webrtc-internals</code> 如果看到这样的字符串,就是 <code>SimulcastEncoderAdapter</code> 实现的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">encoderImplementation SimulcastEncoderAdapter (OpenH264, ExternalEncoder, ExternalEncoder)</span><br></pre></td></tr></table></figure>
<p>android 平台利用 SimulcastEncoderAdapter 开启 simulcast 的一种实例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// SimulcastEncoderAdapter::GetEncoderInfo().implementation_name 输出</span><br><span class="line">// 其中 OpenH264 编码小流, HWEncoder 编码大流</span><br><span class="line">SimulcastEncoderAdapter (OpenH264, HWEncoder)</span><br></pre></td></tr></table></figure>
<h3 id="如何使用-SimulcastEncoderAdapter"><a href="#如何使用-SimulcastEncoderAdapter" class="headerlink" title="如何使用 SimulcastEncoderAdapter"></a>如何使用 SimulcastEncoderAdapter</h3><p>可以参考 chromium blink 的使用方式,具体代码见 <code>third_party/blink/renderer/platform/peerconnection/video_codec_factory.cc</code></p>
<h4 id="创建相应工厂"><a href="#创建相应工厂" class="headerlink" title="创建相应工厂"></a>创建相应工厂</h4><p>仿照 blink 创建 EncoderAdapter 和 CreateVideoEncoderAdapterFactory<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">// @see </span><br><span class="line">template &lt;typename Factory&gt;</span><br><span class="line">bool IsFormatSupported(const Factory* factory,</span><br><span class="line">                       const webrtc::SdpVideoFormat&amp; format) &#123;</span><br><span class="line">  return factory &amp;&amp; IsFormatSupported(factory-&gt;GetSupportedFormats(), format);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Merge |formats1| and |formats2|, but avoid adding duplicate formats.</span><br><span class="line">std::vector&lt;webrtc::SdpVideoFormat&gt; MergeFormats(</span><br><span class="line">    std::vector&lt;webrtc::SdpVideoFormat&gt; formats1,</span><br><span class="line">    const std::vector&lt;webrtc::SdpVideoFormat&gt;&amp; formats2) &#123;</span><br><span class="line">  for (const webrtc::SdpVideoFormat&amp; format : formats2) &#123;</span><br><span class="line">    // Don&#x27;t add same format twice.</span><br><span class="line">    if (!IsFormatSupported(formats1, format))</span><br><span class="line">      formats1.push_back(format);</span><br><span class="line">  &#125;</span><br><span class="line">  return formats1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// This class combines a hardware factory with the internal factory and adds</span><br><span class="line">// internal SW codecs, simulcast, and SW fallback wrappers.</span><br><span class="line">class EncoderAdapter : public webrtc::VideoEncoderFactory &#123;</span><br><span class="line"> public:</span><br><span class="line">  explicit EncoderAdapter(</span><br><span class="line">      std::unique_ptr&lt;webrtc::VideoEncoderFactory&gt; hardware_encoder_factory)</span><br><span class="line">      : hardware_encoder_factory_(std::move(hardware_encoder_factory)) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  webrtc::VideoEncoderFactory::CodecInfo QueryVideoEncoder(</span><br><span class="line">      const webrtc::SdpVideoFormat&amp; format) const override &#123;</span><br><span class="line">    const webrtc::VideoEncoderFactory* factory =</span><br><span class="line">        IsFormatSupported(hardware_encoder_factory_.get(), format)</span><br><span class="line">            ? hardware_encoder_factory_.get()</span><br><span class="line">            : &amp;software_encoder_factory_;</span><br><span class="line">    return factory-&gt;QueryVideoEncoder(format);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  std::unique_ptr&lt;webrtc::VideoEncoder&gt; CreateVideoEncoder(</span><br><span class="line">      const webrtc::SdpVideoFormat&amp; format) override &#123;</span><br><span class="line">    const bool supported_in_software =</span><br><span class="line">        IsFormatSupported(&amp;software_encoder_factory_, format);</span><br><span class="line">    const bool supported_in_hardware =</span><br><span class="line">        IsFormatSupported(hardware_encoder_factory_.get(), format);</span><br><span class="line"></span><br><span class="line">    if (!supported_in_software &amp;&amp; !supported_in_hardware)</span><br><span class="line">      return nullptr;</span><br><span class="line"></span><br><span class="line">    if (absl::EqualsIgnoreCase(format.name.c_str(),</span><br><span class="line">                                         cricket::kVp9CodecName) ||</span><br><span class="line">        absl::EqualsIgnoreCase(format.name.c_str(),</span><br><span class="line">                                         cricket::kAv1CodecName)) &#123;</span><br><span class="line">      // For VP9 and AV1 we don&#x27;t use simulcast.</span><br><span class="line">      // return software_encoder_factory_.CreateVideoEncoder(format);</span><br><span class="line">      return hardware_encoder_factory_-&gt;CreateVideoEncoder(format);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (!supported_in_hardware || !hardware_encoder_factory_.get()) &#123;</span><br><span class="line">      return std::make_unique&lt;webrtc::SimulcastEncoderAdapter&gt;(</span><br><span class="line">          &amp;software_encoder_factory_, nullptr, format);</span><br><span class="line">    &#125; else if (!supported_in_software) &#123;</span><br><span class="line">      return std::make_unique&lt;webrtc::SimulcastEncoderAdapter&gt;(</span><br><span class="line">          hardware_encoder_factory_.get(), nullptr, format);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return std::make_unique&lt;webrtc::SimulcastEncoderAdapter&gt;(</span><br><span class="line">        hardware_encoder_factory_.get(), &amp;software_encoder_factory_, format);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  std::vector&lt;webrtc::SdpVideoFormat&gt; GetSupportedFormats() const override &#123;</span><br><span class="line">    std::vector&lt;webrtc::SdpVideoFormat&gt; software_formats =</span><br><span class="line">        software_encoder_factory_.GetSupportedFormats();</span><br><span class="line">    return hardware_encoder_factory_</span><br><span class="line">               ? MergeFormats(software_formats,</span><br><span class="line">                              hardware_encoder_factory_-&gt;GetSupportedFormats())</span><br><span class="line">               : software_formats;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> private:</span><br><span class="line">  webrtc::InternalEncoderFactory software_encoder_factory_;</span><br><span class="line">  const std::unique_ptr&lt;webrtc::VideoEncoderFactory&gt; hardware_encoder_factory_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">std::unique_ptr&lt;VideoEncoderFactory&gt; CreateVideoEncoderAdapterFactory(</span><br><span class="line">  std::unique_ptr&lt;webrtc::VideoEncoderFactory&gt; hardware_encoder_factory) &#123;</span><br><span class="line">  return std::make_unique&lt;EncoderAdapter&gt;(std::move(hardware_encoder_factory));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="使用工厂"><a href="#使用工厂" class="headerlink" title="使用工厂"></a>使用工厂</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">//  ios 使用</span><br><span class="line">        auto video_encoder_factory = std::move(native_encoder_factory);</span><br><span class="line">        return [self initWithNativeAudioEncoderFactory:webrtc::CreateBuiltinAudioEncoderFactory()</span><br><span class="line">                             nativeAudioDecoderFactory:webrtc::CreateBuiltinAudioDecoderFactory()</span><br><span class="line">                             nativeVideoEncoderFactory:webrtc::CreateVideoEncoderAdapterFactory(std::move(video_encoder_factory))</span><br><span class="line">                             nativeVideoDecoderFactory:webrtc::CreateBuiltinVideoDecoderFactory()</span><br><span class="line">                                     audioDeviceModule:[self audioDeviceModule]</span><br><span class="line">                                 audioProcessingModule:nullptr];</span><br><span class="line">// android 使用</span><br><span class="line">  cricket::MediaEngineDependencies media_dependencies;</span><br><span class="line">  media_dependencies.task_queue_factory = dependencies.task_queue_factory.get();</span><br><span class="line">  media_dependencies.adm = std::move(audio_device_module);</span><br><span class="line">  media_dependencies.audio_encoder_factory = std::move(audio_encoder_factory);</span><br><span class="line">  media_dependencies.audio_decoder_factory = std::move(audio_decoder_factory);</span><br><span class="line">  media_dependencies.audio_processing = std::move(audio_processor);</span><br><span class="line">  auto video_encoder_factory =</span><br><span class="line">      absl::WrapUnique(CreateVideoEncoderFactory(jni, jencoder_factory));</span><br><span class="line">  media_dependencies.video_encoder_factory = </span><br><span class="line">        CreateVideoEncoderAdapterFactory(std::move(video_encoder_factory));</span><br><span class="line">  media_dependencies.video_decoder_factory =</span><br><span class="line">      absl::WrapUnique(CreateVideoDecoderFactory(jni, jdecoder_factory));</span><br><span class="line">  dependencies.media_engine =</span><br><span class="line">      cricket::CreateMediaEngine(std::move(media_dependencies));</span><br><span class="line"></span><br><span class="line">  rtc::scoped_refptr&lt;PeerConnectionFactoryInterface&gt; factory =</span><br><span class="line">      CreateModularPeerConnectionFactory(std::move(dependencies));</span><br></pre></td></tr></table></figure>
<p>参考: <a target="_blank" rel="noopener" href="https://blog.jianchihu.net/webrtc-research-simulcast-layer-change.html">https://blog.jianchihu.net/webrtc-research-simulcast-layer-change.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://johzzy.github.io/2021/06/16/simulcast/" data-id="ckq28t731001e97vq8s4i6uiz" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/public/tags/webrtc/" rel="tag">webrtc</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-field-trails" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/public/2021/06/01/field-trails/" class="article-date">
  <time datetime="2021-06-01T11:34:12.000Z" itemprop="datePublished">2021-06-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/public/2021/06/01/field-trails/">Field Trails</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Field-Trials-介绍"><a href="#Field-Trials-介绍" class="headerlink" title="Field Trials 介绍"></a>Field Trials 介绍</h2><p>field trials （试用特性）是Chrome 的一种特性开关机制，WebRTC沿用了它。其本质是一种特定格式的字符串，格式如下：</p>
<pre><code>&quot;FieldTrialName1/Enabled/FieldTrialName2/Disabled/FieldTrialName3/Disabled/&quot;
</code></pre><h3 id="最简格式为空字符串"><a href="#最简格式为空字符串" class="headerlink" title="最简格式为空字符串"></a>最简格式为空字符串</h3><pre><code>&quot;&quot;
</code></pre><h3 id="基本单元"><a href="#基本单元" class="headerlink" title="基本单元"></a>基本单元</h3><pre><code>&quot;FieldTrialName/FieldTrialValue/&quot;
</code></pre><h3 id="FieldTrialValue的有效值"><a href="#FieldTrialValue的有效值" class="headerlink" title="FieldTrialValue的有效值"></a>FieldTrialValue的有效值</h3><p>常见的FieldTrialValue取值有 Enabled 和 Disabled，一些例外的还有形如 Default，EnabledByFlag_2SL3TL，比如</p>
<pre><code>WebRTC-H264Simulcast/Enabled/
WebRTC-LegacySimulcastLayerLimit/Disabled/
WebRTC-SupportVP9SVC/Default/
WebRTC-SupportVP9SVC/EnabledByFlag_2SL3TL/
WebRTC-Vp9InterLayerPred/Enabled,inter_layer_pred_mode:off/
WebRTC-Vp9InterLayerPred/Enabled,inter_layer_pred_mode:on/
WebRTC-Vp9InterLayerPred/Enabled,inter_layer_pred_mode:onkeypic/
WebRTC-VP8-Forced-Fallback-Encoder-v2/Enabled-1,2,34567/
// 开启 Audio-NetEqExtraDelay 值为 120ms
WebRTC-Audio-NetEqExtraDelay/Enabled-120/
</code></pre><p>特殊例子中FieldTrialValue的具体含义取决于相应代码的解释，一般以Enabled开头</p>
<p>在chrome浏览器中，可以打开 chrome://flags 查看 FieldTrials</p>
<h2 id="WebRTC利用它完成了什么？"><a href="#WebRTC利用它完成了什么？" class="headerlink" title="WebRTC利用它完成了什么？"></a>WebRTC利用它完成了什么？</h2><pre><code>constexpr char kUseLegacySimulcastLayerLimitFieldTrial[] =
    &quot;WebRTC-LegacySimulcastLayerLimit&quot;;


if (!absl::StartsWith(trials.Lookup(kUseLegacySimulcastLayerLimitFieldTrial), &quot;Disabled&quot;)) &#123;
// Case A: kUseLegacySimulcastLayerLimitFieldTrial is Enabled
&#125; else &#123;
// Case B: kUseLegacySimulcastLayerLimitFieldTrial is Disabled
&#125;
</code></pre><p>当我们设置的 fieldtrials 中包含 “WebRTC-LegacySimulcastLayerLimit/Disabled” 则走到 Case B，包含 “WebRTC-LegacySimulcastLayerLimit/Enabled” 则走到 Case A。</p>
<p>思考：都不包含会走A还是B？</p>
<h2 id="FieldTrials-如何使用？"><a href="#FieldTrials-如何使用？" class="headerlink" title="FieldTrials 如何使用？"></a>FieldTrials 如何使用？</h2><pre><code>// c++ @see https://github.com/johzzy/webrtc-mirror/blob/master/system_wrappers/include/field_trial.h#L83
webrtc::field_trial::InitFieldTrialsFromString(const char* trials_string);
// 举例
webrtc::field_trial::InitFieldTrialsFromString(&quot;Audio/Enabled/Video/Disabled/&quot;);



// java @see https://github.com/johzzy/webrtc-mirror/blob/master/sdk/android/api/org/webrtc/PeerConnectionFactory.java#L99
public PeerConnectionFactory.InitializationOptions.Builder setFieldTrials(String fieldTrials)
// 举例
String fieldTrials = &quot;WebRTC-LegacySimulcastLayerLimit/Disabled/&quot;;
PeerConnectionFactory.initialize(
        PeerConnectionFactory.InitializationOptions.builder(context)
                .setFieldTrials(fieldTrials)
                .setEnableInternalTracer(true)
                .createInitializationOptions());
// oc @see https://github.com/johzzy/webrtc-mirror/blob/master/sdk/objc/api/peerconnection/RTCFieldTrials.h#L33
void RTCInitFieldTrialDictionary(NSDictionary&lt;NSString *, NSString *&gt; *fieldTrials) &#123;
if (!fieldTrials) &#123;
    RTCLogWarning(@&quot;No fieldTrials provided.&quot;);
    return;
&#125;
// Assemble the keys and values into the field trial string.
// We don&apos;t perform any extra format checking. That should be done by the underlying WebRTC calls.
NSMutableString *fieldTrialInitString = [NSMutableString string];
for (NSString *key in fieldTrials) &#123;
    NSString *fieldTrialEntry = [NSString stringWithFormat:@&quot;%@/%@/&quot;, key, fieldTrials[key]];
    [fieldTrialInitString appendString:fieldTrialEntry];
&#125;
size_t len = fieldTrialInitString.length + 1;
gFieldTrialInitString.reset(new char[len]);
if (![fieldTrialInitString getCString:gFieldTrialInitString.get()
                            maxLength:len
                            encoding:NSUTF8StringEncoding]) &#123;
    RTCLogError(@&quot;Failed to convert field trial string.&quot;);
    return;
&#125;
webrtc::field_trial::InitFieldTrialsFromString(gFieldTrialInitString.get());
&#125;


举例
NSDictionary *fieldTrials = @&#123;&#125;;
RTCInitFieldTrialDictionary(fieldTrials);


// 命令行
--force-fieldtrials=WebRTC-H264Simulcast/Enabled/
</code></pre><h2 id="FieldTrials-实现"><a href="#FieldTrials-实现" class="headerlink" title="FieldTrials 实现"></a>FieldTrials 实现</h2><pre><code>https://github.com/johzzy/webrtc-mirror/blob/master/system_wrappers/include/field_trial.h
https://github.com/johzzy/webrtc-mirror/blob/master/system_wrappers/source/field_trial_unittest.cc
</code></pre><h2 id="FieldTrials-应用示例"><a href="#FieldTrials-应用示例" class="headerlink" title="FieldTrials 应用示例"></a>FieldTrials 应用示例</h2><p>使用 WebRTC-PcFactoryDefaultBitrates 控制码率</p>
<pre><code>WebRTC-PcFactoryDefaultBitrates/Enabled,min:60,max:4000,start:600/
</code></pre><p>码率控制也可以通过sdp进行（相比FieldTrials，sdp设置的优先级更高）</p>
<pre><code>a=fmtp:102 level-asymmetry-allowed=1;packetization-mode=1;x-google-min-bitrate=400;x-google-max-bitrate=600;profile-level-id=42e01f
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://johzzy.github.io/2021/06/01/field-trails/" data-id="ckq28t72y001997vq3zgn0czf" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/public/tags/webrtc/" rel="tag">webrtc</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2018-05-13-ffmpeg-scale-samples" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/public/2018/05/13/2018-05-13-ffmpeg-scale-samples/" class="article-date">
  <time datetime="2018-05-13T09:49:16.000Z" itemprop="datePublished">2018-05-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/public/2018/05/13/2018-05-13-ffmpeg-scale-samples/">ffmpeg scale samples</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>ffmpeg 音量增益</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://www.ffmpeg.org/doxygen/2.7/af__volume_8c_source.html</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// static inline int16_t av_clip_int16(int a)</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     if ((a+0x8000U) &amp; ~0xFFFF) return (a&gt;&gt;31) ^ 0x7FFF;</span></span><br><span class="line"><span class="comment">//     else                      return a;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">scaleSamplesS16Volume</span><span class="params">(<span class="keyword">uint8_t</span> *dst, <span class="keyword">int</span> nb_samples, <span class="keyword">double</span> adjustVolumeValue)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int16_t</span> *smp_dst       = (<span class="keyword">int16_t</span> *)dst;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> volume = (<span class="keyword">int</span>)(adjustVolumeValue * <span class="number">256</span> + <span class="number">0.5</span>);</span><br><span class="line">    <span class="comment">// volume &lt; if (vol-&gt;volume_i &lt; 0x1000000)</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\r====%d %lf   &quot;</span>, volume, adjustVolumeValue);</span><br><span class="line">    <span class="keyword">if</span> (volume &lt; <span class="number">0x1000000</span>) &#123;</span><br><span class="line">        <span class="comment">// vol-&gt;scale_samples = scale_samples_u8_small;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nb_samples; ++i) &#123;</span><br><span class="line">            smp_dst[i] = av_clip_int16((smp_dst[i] * volume + <span class="number">128</span>) &gt;&gt; <span class="number">8</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// vol-&gt;scale_samples = scale_samples_u8;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nb_samples; ++i) &#123;</span><br><span class="line">            smp_dst[i] = av_clip_int16(((<span class="keyword">int64_t</span>)smp_dst[i] * volume + <span class="number">128</span>) &gt;&gt; <span class="number">8</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://johzzy.github.io/2018/05/13/2018-05-13-ffmpeg-scale-samples/" data-id="ckq28t72x001697vq3cpy0bs2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/public/tags/ffmpeg/" rel="tag">ffmpeg</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2016-08-29-单引号-字符串" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/public/2016/08/29/2016-08-29-%E5%8D%95%E5%BC%95%E5%8F%B7-%E5%AD%97%E7%AC%A6%E4%B8%B2/" class="article-date">
  <time datetime="2016-08-29T02:23:40.000Z" itemprop="datePublished">2016-08-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/public/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/public/2016/08/29/2016-08-29-%E5%8D%95%E5%BC%95%E5%8F%B7-%E5%AD%97%E7%AC%A6%E4%B8%B2/">单引号 字符串</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>阅读项目发现的一段代码</p>
<pre><code>struct PACK_HEAD // 新结构，与类型长度无关
&#123;
    ULONG synch   :16;        //同步字节
    ULONG version : 8;        //协议版本
    ULONG type    : 8;        //包类型
    ULONG sn      :32;        //包序列号
    ULONG fun     :32;        //主功能号
    ULONG sub     :32;        //子功能号
    ULONG datalen :32;        //数据域总长
    ULONG retcode :32;        //返回码
    ULONG total   :16;        //包的分片总数
    ULONG index   :16;        //包的分片序号,从0开始
    ULONG patch   :24;        //补位字节,使结构长度适应4字节对齐方式
    ULONG checksum: 8;        //异或校验和
&#125; m_head;
...
if(this-&gt;m_head.sub == &apos;REC&apos;)              
&#123;
    WriteDebugLog(&quot;录像查询: [%s]&quot;, pTask-&gt;m_body.data);    
        todo_other(...);            
&#125;

this-&gt;m_head.sub == &apos;REC&apos; 这句是什么意思
&apos;REC&apos; 是什么类型
</code></pre><p>查询资料得知这是一种数据表示，测试代码如下</p>
<pre><code>#include &lt;cstdio&gt;
#include &lt;cstdlib&gt;
#include &lt;ctime&gt;

#define WriteErrorLog(format, ...) \
    do &#123;\
    time_t nowtime = time(NULL); struct tm* local = localtime(&amp;nowtime); char timestramp[80] = &#123;0&#125;; strftime(timestramp, 80, &quot;%Y-%m-%d %H:%M:%S&quot;, local);\
    fprintf(stderr, &quot;%s [ERROR] %s(%d): &quot;format&quot;\n&quot;, timestramp, __FUNCTION__ , __LINE__, __VA_ARGS__); \
    &#125; while(0)


int main()
&#123;    
    int ab = &apos;AB&apos;;
    int a = &apos;A&apos;;
    int b = &apos;B&apos;;
    int a_b = (&apos;A&apos; &lt;&lt; 8) + &apos;B&apos;;

    WriteErrorLog(&quot;A:%d, B:%d&quot;, a, b);
    WriteErrorLog(&quot;ab: %d&quot;, ab);
    WriteErrorLog(&quot;a_b: %d&quot;, a_b);

    system(&quot;pause&quot;);
    return 0;
&#125;
</code></pre><p><img src="20160829101359.png," alt="cmd" title="cmd"></p>
<p>‘AB’ 与 12 类比:</p>
<pre><code>&apos;AB&apos; 表示  &apos;A&apos; * 2^8 + &apos;B&apos;
12   表示 1 * 10^1 + 2
</code></pre><p>注意</p>
<pre><code>data_type var = &apos;ABCD&apos;;
这里 &apos;ABCD&apos; 需要在 data_type (char short int long) 的取值范围内, 不可越界.
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://johzzy.github.io/2016/08/29/2016-08-29-%E5%8D%95%E5%BC%95%E5%8F%B7-%E5%AD%97%E7%AC%A6%E4%B8%B2/" data-id="ckq28t72s000u97vq2b6wdh7f" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2016-07-28-centos_upgrade_python" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/public/2016/07/28/2016-07-28-centos_upgrade_python/" class="article-date">
  <time datetime="2016-07-28T01:46:14.000Z" itemprop="datePublished">2016-07-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/public/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/public/2016/07/28/2016-07-28-centos_upgrade_python/">CentOS 升级 Python 整理记录</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>CentOS 升级 Python 整理记录</p>
<pre><code>CentOS 版本: 6.0 (x64)
Python 原版本： 2.6.5
Python 升级版本：2.7.12
Python 2.7.12 链接： https://www.python.org/ftp/python/2.7.12/Python-2.7.12.tar.xz
</code></pre><p>执行过程</p>
<pre><code># 预先准备
cd /usr/bin
python --version

# 拷贝 python2.6.5 副本
cp python python2.6.5  # 安全起见(1)

# 修改下述三个文件开头, 指定 python 解释器为 /usr/bin/python2.6.5
# 原因是它们不支持 python27
vim /usr/bin/yum
vim /usr/bin/ibus-setup
vim /usr/libexec/ibus-ui-gtk

# 下载安装
wget https://www.python.org/ftp/python/2.7.12/Python-2.7.12.tar.xz
tar xf Python-2.7.12.tar.xz
cd Python-2.7.12
./configure
make all
make install
make clean
make distclean
/usr/local/bin/python2.7 --version
rm /usr/bin/python # 呼应上文命令(1)
ln -s /usr/local/bin/python2.7 /usr/bin/python

# 安装后
## 修复 或 安装 pip
yum install python-pip
pip install --upgrade setuptools
wget --no-check-certificate  https://raw.github.com/pypa/pip/master/contrib/get-pip.py # 命令(3)
wget --no-check-certificate  https://bootstrap.pypa.io/get-pip.py                      # 命令(4)

# 尝试运行 命令 (3, 4) 下载的脚本, 至此 pip 修复完成 
python get-pip.py
pip --version
pip install bs4
pip install requests

# 小工具
yum install dos2unix lrzsz
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://johzzy.github.io/2016/07/28/2016-07-28-centos_upgrade_python/" data-id="ckq28t72r000r97vqgpfqall4" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2016-07-28-centos_upgrade_gcc" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/public/2016/07/28/2016-07-28-centos_upgrade_gcc/" class="article-date">
  <time datetime="2016-07-28T01:45:50.000Z" itemprop="datePublished">2016-07-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/public/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/public/2016/07/28/2016-07-28-centos_upgrade_gcc/">CentOS 升级 GCC 整理记录</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>CentOS 升级 GCC 整理记录</p>
<pre><code>CentOS 版本: 6.0 (x64)
GCC 原版本： 4.4.7
GCC 升级版本：4.8.5
GCC 4.8.5 链接： https://ftp.gnu.org/gnu/gcc/gcc-4.8.5/gcc-4.8.5.tar.gz
</code></pre><p>执行过程</p>
<pre><code>wget https://ftp.gnu.org/gnu/gcc/gcc-4.8.5/gcc-4.8.5.tar.gz
tar zxf gcc-4.8.5.tar.gz
cd gcc-4.8.5

yum install gcc g++
yum install glibc-static
yum install cloog-ppl gmp-devel

wget ftp://gcc.gnu.org/pub/gcc/infrastructure/isl-0.11.1.tar.bz2
tar jxf isl-0.11.1.tar.bz2
cd isl-0.11.1
./configure
make
make install

cd ..
./contrib/download_prerequisites
mkdir build
cd build
../configure --prefix=/usr --enable-languages=c,c++ --disable-multilib
make -j4
make install
</code></pre><p>GCC 4.8.5 支持 C++11 的部分特性</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://johzzy.github.io/2016/07/28/2016-07-28-centos_upgrade_gcc/" data-id="ckq28t72q000o97vqgwmxatid" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2016-6-6-browser-plugin" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/public/2016/06/06/2016-6-6-browser-plugin/" class="article-date">
  <time datetime="2016-06-06T04:40:05.000Z" itemprop="datePublished">2016-06-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/public/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/public/2016/06/06/2016-6-6-browser-plugin/">浏览器插件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Chrome 插件</p>
<pre><code>1. ADfree.Player.Online
一款屏蔽国内主要视频网站部分视频广告的扩展。

2. Allow Copy
解除一些网站不允许的右键复制

3. Bookmark Manager
来自 google

4. ChaZD
ChaZD 查字典，简洁易用的英汉字典扩展程序，支持划词哦:)

5. crxMouse Chrome Gestures
Boost browsing productivity with your fingertips - Mouse Gestures, Super Drag, Wheel Gestures, Rocker Gestures.
(不经常使用, 更多使用 vim 插件)

6. Disconnect
Make the web faster, more private, and more secure.
(google 已跪, 可以使用 duckduckgo)

7. Ghostery
Enjoy a faster, safer and cleaner browsing experience.
(用于屏蔽网页的一些信息跟踪)

8. Google Art Project
Art Project masterpieces from Google Cultural Institute in your browser tabs
(还行)

9. HTTPS Everywhere
Encrypt the Web! Automatically use HTTPS security on many sites.
(提高安全姿势)

10. ImprovedTube - YouTube Extension
Improves YouTube&apos;s functions and site with Limited Permissions. Auto HD, Resize, Annotations, Playback Speed and more.
(美化youtube, 不及 Magic Actions)

11. iReader
View news stories and other articles in a very easy to read, clutter-free, scrollable display.
(阅读模式)

12. Magic Actions for YouTube™
Enhance your YouTube watching experience! Auto HD, Ad Block, Cinema Mode, Mouse Wheel Volume Control, Screenshot...
(更加美化youtube)

13. Octotree
Code tree for GitHub and GitLab
(神器)

14. OneTab
Save up to 95% memory and reduce tab clutter
(节省资源)

15. Privacy Badger
Privacy Badger protects you from trackers as you surf the web!
(隐私安全)

16. Proxy SwitchyOmega
Manage and switch between multiple proxies quickly &amp; easily.
(科学上网)

17. Redirector
Automatically redirect pages based on user-defined rules. E.g. always redirect an article url to its printer-friendly version.

18. Remove Google Redirection
Prohibit click-tracking, and prevent url redirection when clicks on the result links in Google search page

19. scroll style
Like android&apos;s scroll bars .像android的滚动条

20. StopFingerprinting
Fingerprinting analysis extension.
(隐私安全, 不知是否有效)

21. Stylish
Restyle the web with Stylish, a user styles manager. Stylish lets you easily install themes and skins for many popular sites.
(神器, 自定义 css 样式)

22. Tampermonkey
The most popular userscript manager for Blink-based browsers
(神器, 自定义 js 样式)

23. The Great Suspender
Automatically suspends unused tabs to free up system resources
(节省资源, 配合 OneTab)

24. User-Agent Switcher for Google Chrome
User-Agent Switcher for Google Chrome switches between different user-agents.

25. Vimium
The Hacker&apos;s Browser. Vimium provides keyboard shortcuts for navigation and control in the spirit of Vim.
(神器, 已上瘾)

26. WebRTC Leak Prevent
Prevent WebRTC leaks, without blocking WebRTC.
(安全, 隐藏本地IP)

27. 买买买购物助手
(还没有使用)

28. 保护眼睛
阿姆斯特朗回旋喷气式阿姆斯特朗墨镜

29. 隐藏帖自动回复 (AutoReply 纯净版)
自动回复隐藏帖 (要求已登录, 改自同名 Chrome 插件, 版权归原作者所有)
</code></pre><p>Firefox</p>
<pre><code>ACVAA
Adblock Plus
Disconnect
Disconnect Search
Element Hiding Helper for Adblock Plus
FEBE
FoxyProxy Standard
Ghostery
Greasemonkey
HTTPS-Everywhere
NoScript
Omnibar
PopVideo
SmartVideo For YouTube
Vimperator
</code></pre><p>以下在破坏本文规则</p>
<p>PowerShell</p>
<pre><code>posh-git
PowerTab
PSCX
PsGet
PSReadline
</code></pre><p>Zsh</p>
<pre><code>git 
incr  
terminitor 
tmux
z 
zsh-history-substring-search
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://johzzy.github.io/2016/06/06/2016-6-6-browser-plugin/" data-id="ckq28t72w001397vqdxin18jf" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2016-4-13-my-string-format" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/public/2016/04/13/2016-4-13-my-string-format/" class="article-date">
  <time datetime="2016-04-13T09:57:35.000Z" itemprop="datePublished">2016-04-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/public/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/public/2016/04/13/2016-4-13-my-string-format/">一种字符串序列描述</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>将两个序列</p>
<pre><code>A = &#123;1, 4, 6, 8, 9&#125;
B = &#123;10, 11, 12, ...20&#125;
</code></pre><p>转为如下形式</p>
<pre><code>string a = &quot;1,4,6,8-9&quot;;
string b = &quot;10-20&quot;; 
</code></pre><p>实现如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">QString SeriesEdit::FormatSeries(const QSet&lt;int&gt;&amp; series)</span><br><span class="line">&#123;	</span><br><span class="line">	QList&lt;int&gt; series_list = series.toList();</span><br><span class="line">	qSort(series_list.begin(), series_list.end());</span><br><span class="line"></span><br><span class="line">	int last = 0xffffffff;</span><br><span class="line">	bool match = false;</span><br><span class="line"></span><br><span class="line">	QString series_str;</span><br><span class="line">	for (QList&lt;int&gt;::iterator it = series_list.begin(); it != series_list.end(); ++it)</span><br><span class="line">	&#123;</span><br><span class="line">		int var = *it;</span><br><span class="line">		if (it == series_list.begin())</span><br><span class="line">		&#123;</span><br><span class="line">			series_str += QString::number(var);</span><br><span class="line">		&#125;</span><br><span class="line">		else if (last + 1 == var)</span><br><span class="line">		&#123;</span><br><span class="line">			series_str += &quot;-&quot;;</span><br><span class="line">			match = true;</span><br><span class="line">		&#125;</span><br><span class="line">		else if (match)</span><br><span class="line">		&#123;			</span><br><span class="line">			series_str += QString::number(last) + &quot;,&quot; + QString::number(var);</span><br><span class="line">			match = false;</span><br><span class="line">		&#125;	</span><br><span class="line">		else</span><br><span class="line">		&#123;</span><br><span class="line">			series_str += &quot;,&quot; + QString::number(var);</span><br><span class="line">		&#125;</span><br><span class="line">		last = *it;</span><br><span class="line">	&#125;</span><br><span class="line">	if (match)</span><br><span class="line">	&#123;</span><br><span class="line">		series_str += QString::number(last);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	return series_str.split(&quot;-&quot;, QString::SkipEmptyParts).join(&quot;-&quot;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://johzzy.github.io/2016/04/13/2016-4-13-my-string-format/" data-id="ckq28t72v001097vq79bhbkm5" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2016-1-18-C++中set和get的简单方式" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/public/2016/01/18/2016-1-18-C++%E4%B8%ADset%E5%92%8Cget%E7%9A%84%E7%AE%80%E5%8D%95%E6%96%B9%E5%BC%8F/" class="article-date">
  <time datetime="2016-01-18T02:46:05.000Z" itemprop="datePublished">2016-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/public/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/public/2016/01/18/2016-1-18-C++%E4%B8%ADset%E5%92%8Cget%E7%9A%84%E7%AE%80%E5%8D%95%E6%96%B9%E5%BC%8F/">C++中set和get的简单方式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在C#中, 有比较通用的set和get, 在C++中可以使用引用和访问限制符来简单处理,   具体如下</p>
<pre><code>`
#define SUCCESS 1 // #define SUCCESS 1
#define FAIL 0 // #define FAIL 0
#include &lt;iostream&gt;
int add(int a, int b) &#123; return a + b; &#125;
class A
&#123;
private:
    int a_;
    int b_;
public:
    const int&amp; a;
    const int&amp; b;
public:
    int x_;
    int y_;
    const int&amp; x;
    const int&amp; y;
    A()
    : a_(0), b_(0), x_(0), y_(0)
    , a(a_), b(b_), x(x_), y(y_)
    &#123;&#125;

    void print() &#123; 
        std::cout &lt;&lt; &quot;  a=&quot; &lt;&lt; a &lt;&lt; &quot;, a_=&quot; &lt;&lt; a_ 
              &lt;&lt; &quot;, b=&quot; &lt;&lt; b &lt;&lt; &quot;, b_=&quot; &lt;&lt; b_
              &lt;&lt; &quot;, x=&quot; &lt;&lt; x &lt;&lt; &quot;, x_=&quot; &lt;&lt; x_
              &lt;&lt; &quot;, y=&quot; &lt;&lt; y &lt;&lt; &quot;, y_=&quot; &lt;&lt; y_
                          &lt;&lt; &quot;.\n&quot;;
    &#125;
&#125;;

int  main()
&#123;
    int result = add(SUCCESS, FAIL);
    A a;
    a.x_ = 4;    // (1) 
    //a.x = 5;    // (2) 
    //a.a_ = 3; // (3)
    //a.a = 5;  // (4)
    a.y_ = a.x; // (5)
    // a.y = a.x; // (6)
    // a.a = a.y; // (7)    
    a.print();
    return 0;
&#125;
`
</code></pre><p>其中,</p>
<p>(1) <code>public int x_</code>, 跟全局变量的访问一样<br>(2) <code>a.x</code> 为 <code>public int&amp;</code> 类型, 指向<code>public int x_</code>, 这里相当于 <code>set</code><br>(3) error, <code>private int a_</code> 尝试修改私有变量的值<br>(4) error, <code>public const int&amp; y</code> 尝试修改<code>const</code>变量<br>(5) <code>a.x</code> 相当于<code>get</code>, 并修改 <code>y_</code><br>(6) <code>error</code>, <code>public const int&amp; y</code> 尝试修改<code>const</code>变量<br>(7) <code>error</code>, <code>a.x</code> 相当于<code>get</code>, <code>a.a</code> 尝试修改<code>const</code>变量  </p>
<p>对此，如果一个变量 <code>var</code> 是只读的，但是在对象构造时需要赋值, 可以参照如下方式</p>
<pre><code>class A 
&#123;
private:
    int var_;
public:
    const int&amp; var;
public:
    A(int a):var_(a)&#123;&#125;
    Foo() &#123; /*process var_*/ &#125;
&#125;;
</code></pre><p>于是, 在初始化是可以 <code>A a(5)</code>, 在<code>a</code>的内部, 仍然可以对 <code>var_</code> 做任何处理, 使用时 <code>a.var</code>, 而不必考虑<code>var</code>被外界修改的问题.</p>
<p>(完)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://johzzy.github.io/2016/01/18/2016-1-18-C++%E4%B8%ADset%E5%92%8Cget%E7%9A%84%E7%AE%80%E5%8D%95%E6%96%B9%E5%BC%8F/" data-id="ckq28t72u000x97vq6jso572l" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/public/page/2/">2</a><a class="extend next" rel="next" href="/public/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/public/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a><span class="category-list-count">16</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/public/tags/C/" rel="tag">C++</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/public/tags/FTP/" rel="tag">FTP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/public/tags/Python/" rel="tag">Python</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/public/tags/ffmpeg/" rel="tag">ffmpeg</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/public/tags/lambda/" rel="tag">lambda</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/public/tags/shell/" rel="tag">shell</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/public/tags/webrtc/" rel="tag">webrtc</a><span class="tag-list-count">3</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/public/archives/2021/06/">June 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/public/archives/2018/05/">May 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/public/archives/2016/08/">August 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/public/archives/2016/07/">July 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/public/archives/2016/06/">June 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/public/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/public/archives/2016/01/">January 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/public/archives/2015/11/">November 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/public/archives/2015/01/">January 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/public/archives/2014/11/">November 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/public/archives/2014/02/">February 2014</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/public/2021/06/18/simulcast-support-in-srs/">simulcast support in srs</a>
          </li>
        
          <li>
            <a href="/public/2021/06/16/simulcast/">Simulcast</a>
          </li>
        
          <li>
            <a href="/public/2021/06/01/field-trails/">Field Trails</a>
          </li>
        
          <li>
            <a href="/public/2018/05/13/2018-05-13-ffmpeg-scale-samples/">ffmpeg scale samples</a>
          </li>
        
          <li>
            <a href="/public/2016/08/29/2016-08-29-%E5%8D%95%E5%BC%95%E5%8F%B7-%E5%AD%97%E7%AC%A6%E4%B8%B2/">单引号 字符串</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 johzzy<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/public/" class="mobile-nav-link">Home</a>
  
    <a href="/public/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/public/fancybox/jquery.fancybox.css">

  
<script src="/public/fancybox/jquery.fancybox.pack.js"></script>




<script src="/public/js/script.js"></script>




  </div>
</body>
</html>